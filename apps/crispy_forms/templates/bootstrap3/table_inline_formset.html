{% load crispy_forms_tags %}
{% load crispy_forms_utils %}
{% load crispy_forms_field %}


<script type="text/javascript">
    $(function () {
        $('#id_contact_info_table tbody tr').formset({
            formCssClass: 'dynamic-contact-form',
            prefix: "{{ contact_formset.prefix }}"
        });
        $('table.form-container').formset({
            formCssClass: 'dynamic-event-form',
            prefix: "{{ event_formset.prefix }}",
            added: function (row) {
                // Find the fields with the calendar widget
                $(row).find('.vDateField').each(function (i) {
                    // Remove the cloned spam element: it links to an incorrect calendar
                    $(this).parent().find('span').remove();
                    // DateTimeShortcuts is defined in DateTimeShortcuts.js in the Django admin media
                    DateTimeShortcuts.addCalendar(this);
                });
            }
        });
    });
</script>
<style type="text/css">
	.add-row {
		padding-left: 18px;
		background:({{ MEDIA_URL }} images / add . png) no-repeat left center;
	}

	.delete-row {
		float: right;
		display: block;
		margin-left: 4px;
		padding-left: 18px;
		background:({{ MEDIA_URL }} images / delete . png) no-repeat left center;
	}

	.dynamic-event-form th {
		text-align: right;
		font-weight: bold;
	}

	.dynamic-event-form td span img {
		vertical-align: middle;
		border: 0;
	}
</style>

<div>
	{{ formset.management_form|crispy }}
</div>

<table id="id_contact_info_table">
	<thead>
	{% if formset.readonly and not formset.queryset.exists %}
	{% else %}
		<tr>
			{% for field in formset.forms.0 %}
				{% if field.label and not field.is_hidden %}
					<th {% if field.field.required %}requiredField{% endif %}>
						{{ field.name|safe }}
						{% if field.field.required %}
							<span class="asteriskField">*</span>{% endif %}
					</th>
				{% endif %}
			{% endfor %}

		</tr>
	{% endif %}
	</thead>

	<tbody>
	<tr class="hidden empty-form">
		{% for field in formset.empty_form %}
			{% include 'bootstrap3/field.html' with tag="td" form_show_labels=False %}
		{% endfor %}
	</tr>

	{% for form in formset %}
		{% if form_show_errors and not form.is_extra %}
			{% include "bootstrap3/errors.html" %}
		{% endif %}

		<tr id="{{ form.prefix }}-row">
			{% for field in form %}
				{% include 'bootstrap3/field.html' with tag="td" form_show_labels=False %}
			{% endfor %}
		</tr>
	{% endfor %}
	</tbody>
</table>

{% include "bootstrap3/inputs.html" %}

